<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIB PLC Advanced Calculator - CM Rabbi</title>
    <style>
        :root { --primary: #006837; --secondary: #1e3a5f; --bg: #f4f7f6; --profit-val: #00d4ff; --final-val: #4ade80; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .main-card { background: #fff; width: 100%; max-width: 500px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; border-top: 6px solid var(--primary); }
        .header { text-align: center; padding: 20px; border-bottom: 1px solid #eee; }
        .address-container { color: #333; font-size: 0.9rem; font-weight: 600; line-height: 1.4; }
        .mode-box { display: flex; background: #f1f1f1; margin: 15px 20px; border-radius: 50px; padding: 4px; }
        .mode-btn { flex: 1; padding: 12px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s; color: #666; }
        .mode-btn.active { background: var(--primary); color: white; }
        .content { padding: 0 20px 20px; }
        .form-group { margin-bottom: 12px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: var(--secondary); font-size: 0.85rem; }
        input, select { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 15px; box-sizing: border-box; }
        
        .res-display { background: var(--secondary); color: white; padding: 15px; border-radius: 15px; margin-top: 15px; }
        .res-line { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; font-size: 0.95rem; gap: 10px; }
        .res-line.final { margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); font-weight: bold; font-size: 1.15rem; }
        
        .label-text { white-space: nowrap; }
        .val-profit { color: var(--profit-val); font-weight: bold; text-align: right; }
        .val-final { color: var(--final-val); font-weight: bold; text-align: right; }
        .val-white { color: white; text-align: right; }

        .footer-credit { background: #000; color: #ffd700; text-align: center; padding: 12px; font-weight: bold; }
        
        #adminPanel { display: none; padding: 20px; background: #fff; border-top: 2px dashed #ccc; }
        .admin-nav { display: flex; gap: 4px; margin-bottom: 15px; background: #f8f9fa; padding: 5px; border-radius: 10px; overflow-x: auto; }
        .nav-tab { flex: 1; padding: 8px; font-size: 11px; cursor: pointer; text-align: center; border-radius: 8px; font-weight: bold; color: #555; min-width: 60px; }
        .nav-tab.active { background: var(--secondary); color: white; }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .itd-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 10px; }
        .itd-table th, .itd-table td { border: 1px solid #eee; padding: 8px; text-align: center; }
        .del-btn { color: white; background: #ff4d4d; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .save-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; margin-top: 10px; font-weight: bold; cursor: pointer; }
        .admin-label { font-size: 11px; font-weight: bold; color: #555; margin-top: 8px; display: block; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="header"><div id="displayAddress" class="address-container"></div></div>
    <div class="mode-box">
        <button class="mode-btn active" id="btnMTDR" onclick="setMode('MTDR')">MTDR</button>
        <button class="mode-btn" id="btnITD" onclick="setMode('ITD')">ITD (Scheme)</button>
    </div>

    <div class="content">
        <div class="form-group"><label id="labelAmt">Deposit Amount</label><div id="inputSpace"></div></div>
        <div class="form-group"><label>Duration</label><select id="duration" onchange="calculate()"></select></div>
        <div class="form-group"><label>Profit Rate (%)</label><input type="text" id="pRate" readonly></div>
        <div id="taxSection" class="form-group">
            <label>Income Tax Status</label>
            <div style="display: flex; background: #f1f1f1; border-radius: 10px; padding: 4px; gap: 4px;">
                <div class="mode-btn active" id="tax10" style="font-size: 12px; padding: 8px;" onclick="setTax(10)">e-TIN (10%)</div>
                <div class="mode-btn" id="tax15" style="font-size: 12px; padding: 8px;" onclick="setTax(15)">Non e-TIN (15%)</div>
            </div>
        </div>
        <div class="res-display">
            <div id="details"></div>
            <div class="res-line final">
                <span id="finalLabel" class="label-text">Maturity Total Amount:</span>
                <span id="vTotal" class="val-final">0.00</span>
            </div>
        </div>
    </div>

    <div class="footer-credit">Created by CM Rabbi</div>
    <button style="background:none; border:none; color:#ccc; width:100%; cursor:pointer; font-size:10px; padding:15px;" onclick="openAdmin()">Admin Access</button>
    
    <div id="adminPanel">
        <div class="admin-nav">
            <div class="nav-tab active" onclick="switchTab('tabAddr', this)">ঠিকানা</div>
            <div class="nav-tab" onclick="switchTab('tabMTDR', this)">MTDR</div>
            <div class="nav-tab" onclick="switchTab('tabITD', this)">ITD</div>
            <div class="nav-tab" onclick="switchTab('tabSettings', this)">সেটিংস</div>
        </div>
        
        <div id="tabAddr" class="admin-section active">
            <label class="admin-label">ঠিকানা পরিবর্তন:</label>
            <textarea id="editAddr" style="width:100%; height:70px; padding:10px; border-radius:10px; border:1px solid #ddd;"></textarea>
            <button class="save-btn" onclick="saveAddress()">Update Address</button>
        </div>

        <div id="tabMTDR" class="admin-section">
            <div id="mtdrList"></div>
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; margin-top:10px;">
                <label class="admin-label">মাস ও হার আপডেট:</label>
                <input type="number" id="newMMonth" placeholder="মাস">
                <input type="number" id="newMRate" step="0.01" placeholder="হার (%)">
                <button class="save-btn" style="background:var(--secondary);" onclick="addMTDR()">Add/Update MTDR</button>
            </div>
        </div>

        <div id="tabITD" class="admin-section">
            <div style="background:#f0fdf4; padding:10px; border-radius:10px; border:1px solid #bbf7d0; margin-bottom:10px;">
                <label class="admin-label">Update ITD Profit Rate (%):</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="itdGlobalRate" step="0.01" style="flex:2">
                    <button onclick="updateITDRate()" style="flex:1; background:var(--primary); color:white; border:none; border-radius:10px;">Update</button>
                </div>
            </div>
            <div style="overflow-x:auto;"><table class="itd-table"><thead><tr><th>কিস্তি</th><th>বছর</th><th>মুনাফা</th><th>Action</th></tr></thead><tbody id="itdTableBody"></tbody></table></div>
            <div style="background:#f9f9f9; padding:10px; border-radius:10px;">
                <label class="admin-label">মাসিক কিস্তি:</label>
                <input type="number" id="newIAmt" placeholder="যেমন: ৫০০">
                <label class="admin-label">মেয়াদ:</label>
                <select id="newIYr"><option value="2">2y</option><option value="3">3y</option><option value="5">5y</option><option value="8">8y</option><option value="10">10y</option><option value="12">12y</option></select>
                <label class="admin-label">প্রাক্কলিত মুনাফা:</label>
                <input type="number" id="newIProfit" placeholder="মুনাফা">
                <button class="save-btn" style="background:var(--secondary);" onclick="addITD()">Add ITD Row</button>
            </div>
        </div>

        <div id="tabSettings" class="admin-section">
            <label class="admin-label">পুরাতন পাসওয়ার্ড:</label>
            <input type="password" id="oldPass">
            <label class="admin-label">নতুন পাসওয়ার্ড:</label>
            <input type="password" id="newPass">
            <label class="admin-label">সিকিউরিটি কোড:</label>
            <input type="text" id="secCode" placeholder="Enter Security Code">
            <button class="save-btn" onclick="changePassword()">পাসওয়ার্ড আপডেট</button>
        </div>
        
        <button onclick="closeAdmin()" style="width:100%; background:#eee; border:none; padding:12px; border-radius:10px; margin-top:10px; font-weight:bold; cursor:pointer;">Close</button>
    </div>
</div>

<script>
    let currentMode = 'MTDR', currentTax = 10, securityCode = "842170";
    
    // Default Data
    let db = {
        address: "Al-Arafah Islami Bank PLC\nS P S Bazar Outlet\nKayaria, Kalkini, Madaripur.",
        mtdr: { "1": 7.50, "3": 8.50, "12": 12.00, "24": 13.50 },
        itd: [{amt: 500, yr: 2, prof: 1545}, {amt: 1000, yr: 5, prof: 20817}],
        itdRate: 12.00,
        adminPass: "As@04004"
    };

    // Load Data from LocalStorage
    function loadSavedData() {
        const savedDB = localStorage.getItem('aib_calc_db');
        if (savedDB) {
            db = JSON.parse(savedDB);
        }
    }

    // Save Data to LocalStorage
    function saveData() {
        localStorage.setItem('aib_calc_db', JSON.stringify(db));
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('btnMTDR').classList.toggle('active', mode === 'MTDR');
        document.getElementById('btnITD').classList.toggle('active', mode === 'ITD');
        document.getElementById('taxSection').style.display = (mode === 'MTDR') ? 'block' : 'none';
        const inputSpace = document.getElementById('inputSpace');
        if(mode === 'ITD') {
            document.getElementById('labelAmt').innerText = "Monthly Deposit";
            document.getElementById('finalLabel').innerText = "মুনাফাসহ মোট জমা:";
            refreshITDDrowpdown();
        } else {
            document.getElementById('labelAmt').innerText = "Deposit Amount";
            document.getElementById('finalLabel').innerText = "Maturity Total Amount:";
            inputSpace.innerHTML = `<input type="tel" id="mainAmt" placeholder="Input Amount" oninput="formatCurrency(this)">`;
            document.getElementById('duration').innerHTML = Object.keys(db.mtdr).sort((a,b)=>a-b).map(m => `<option value="${m}">${m} Months</option>`).join('');
            resetDisplay();
        }
    }

    function formatCurrency(el) {
        let val = el.value.replace(/,/g, '');
        if(!isNaN(val) && val !== "") { el.value = Number(val).toLocaleString('en-IN'); calculate(); } else { resetDisplay(); }
    }

    function refreshITDDrowpdown() {
        let uniqueAmts = [...new Set(db.itd.map(i => i.amt))].sort((a,b)=>a-b);
        document.getElementById('inputSpace').innerHTML = `<select id="mainAmt" onchange="updateITDDuration()">${uniqueAmts.map(a => `<option value="${a}">${a}</option>`).join('')}</select>`;
        updateITDDuration();
    }

    function updateITDDuration() {
        let val = document.getElementById('mainAmt').value;
        let durations = db.itd.filter(i => i.amt == val).map(i => i.yr);
        document.getElementById('duration').innerHTML = durations.map(y => `<option value="${y}">${y} বছর</option>`).join('');
        document.getElementById('pRate').value = db.itdRate.toFixed(2) + "%";
        calculate();
    }

    function setTax(val) { currentTax = val; document.getElementById('tax10').classList.toggle('active', val === 10); document.getElementById('tax15').classList.toggle('active', val === 15); calculate(); }
    
    function resetDisplay() { 
        const input = document.getElementById('mainAmt');
        if(input && input.tagName === 'INPUT') input.value = "";
        document.getElementById('details').innerHTML = ""; 
        document.getElementById('vTotal').innerText = "0.00"; 
    }

    function calculate() {
        const details = document.getElementById('details'), vTotal = document.getElementById('vTotal'), input = document.getElementById('mainAmt');
        if(!input || !input.value || input.value == "0") { 
            document.getElementById('details').innerHTML = ""; 
            document.getElementById('vTotal').innerText = "0.00"; 
            return; 
        }
        
        if(currentMode === 'MTDR') {
            let dep = parseFloat(input.value.replace(/,/g, '')) || 0, mon = document.getElementById('duration').value, rate = db.mtdr[mon] || 0;
            document.getElementById('pRate').value = rate.toFixed(2) + "%";
            let netMonProf = ((dep * (rate/100)) / 12) * ((100-currentTax)/100);
            details.innerHTML = `<div class="res-line"><span class="label-text">Net Monthly Profit:</span><span class="val-profit">${netMonProf.toLocaleString('en-IN',{minimumFractionDigits:2})}</span></div>`;
            vTotal.innerText = (dep + (netMonProf * mon)).toLocaleString('en-IN',{minimumFractionDigits:2});
        } else {
            let amt = input.value, yr = document.getElementById('duration').value, item = db.itd.find(i => i.amt == amt && i.yr == yr);
            let totalSaved = amt * 12 * yr, profit = item ? item.prof : 0;
            details.innerHTML = `<div class="res-line"><span class="label-text">মোট জমা:</span><span class="val-white">${totalSaved.toLocaleString('en-IN')}</span></div><div class="res-line"><span class="label-text">প্রাক্কলিত মুনাফা:</span><span class="val-profit">${profit.toLocaleString('en-IN')}</span></div>`;
            vTotal.innerText = (totalSaved + profit).toLocaleString('en-IN');
        }
    }

    function updateITDRate() {
        let newRate = parseFloat(document.getElementById('itdGlobalRate').value);
        if(!isNaN(newRate)) { db.itdRate = newRate; saveData(); if(currentMode === 'ITD') document.getElementById('pRate').value = newRate.toFixed(2) + "%"; resetDisplay(); alert("ITD Profit Rate Updated!");}
    }

    function renderAdminLists() {
        let mHtml = ''; Object.keys(db.mtdr).sort((a,b)=>a-b).forEach(m => { mHtml += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; font-size:12px;"><span>${m} মাস (${db.mtdr[m]}%)</span><span class="del-btn" onclick="deleteMTDR('${m}')">Del</span></div>`; });
        document.getElementById('mtdrList').innerHTML = mHtml;
        let iHtml = ''; db.itd.sort((a,b)=>a.amt-b.amt).forEach((item, idx) => { iHtml += `<tr><td>${item.amt}</td><td>${item.yr}y</td><td>${item.prof}</td><td><button class="del-btn" onclick="deleteITD(${idx})">Del</button></td></tr>`; });
        document.getElementById('itdTableBody').innerHTML = iHtml;
        document.getElementById('itdGlobalRate').value = db.itdRate;
    }

    function addMTDR() { 
        let m = document.getElementById('newMMonth').value, r = document.getElementById('newMRate').value; 
        if(m && r) { 
            db.mtdr[m] = parseFloat(r); 
            document.getElementById('newMMonth').value = "";
            document.getElementById('newMRate').value = "";
            saveData(); renderAdminLists(); resetDisplay(); 
        } 
    }
    function deleteMTDR(m) { delete db.mtdr[m]; saveData(); renderAdminLists(); resetDisplay(); }
    function addITD() { 
        let a = parseInt(document.getElementById('newIAmt').value), y = parseInt(document.getElementById('newIYr').value), p = parseInt(document.getElementById('newIProfit').value); 
        if(a && p) { 
            db.itd.push({amt: a, yr: y, prof: p}); 
            document.getElementById('newIAmt').value = "";
            document.getElementById('newIProfit').value = "";
            saveData(); renderAdminLists(); refreshITDDrowpdown(); resetDisplay(); 
        } 
    }
    function deleteITD(i) { db.itd.splice(i, 1); saveData(); renderAdminLists(); refreshITDDrowpdown(); resetDisplay(); }
    
    function openAdmin() { 
        let p = prompt("Password:"); 
        if(p === db.adminPass) { 
            document.getElementById('adminPanel').style.display = 'block'; 
            document.getElementById('editAddr').value = db.address; 
            renderAdminLists(); 
        } else {
            alert("ভুল পাসওয়ার্ড!");
        }
    }
    function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
    function switchTab(id, btn) { document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active')); document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); document.getElementById(id).classList.add('active'); btn.classList.add('active'); }
    
    function saveAddress() { 
        db.address = document.getElementById('editAddr').value; 
        saveData(); renderAddress(); resetDisplay(); alert("ঠিকানা আপডেট হয়েছে!");
    }
    function renderAddress() { document.getElementById('displayAddress').innerHTML = db.address.split('\n').map(l => `<div>${l}</div>`).join(''); }
    
    function changePassword() {
        let oldP = document.getElementById('oldPass').value, newP = document.getElementById('newPass').value, code = document.getElementById('secCode').value;
        if(code === securityCode) {
            if(oldP === db.adminPass) { 
                db.adminPass = newP; 
                saveData();
                document.getElementById('oldPass').value = "";
                document.getElementById('newPass').value = "";
                document.getElementById('secCode').value = "";
                resetDisplay(); 
                alert("Password Updated Successfully!"); 
            } 
            else { alert("ভুল পুরাতন পাসওয়ার্ড! আবার চেষ্টা করুন।"); }
        } else { alert("ভুল সিকিউরিটি কোড!"); }
    }

    // Initialize
    loadSavedData();
    renderAddress();
    setMode('MTDR');
</script>
</body>
</html>